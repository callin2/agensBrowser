<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Query</title>
	<!-- <link rel="stylesheet" type="text/css" href="/src/main/resources/templates/css/basic.css" />
	<script src="/src/main/resources/templates/script/jquery-3.2.1.min.js"></script>
	<script src="/src/main/resources/templates/script/utils.js"></script> -->
	<link rel="stylesheet" type="text/css" href="/css/basic.css" />
	<script src="/script/jquery-3.2.1.min.js"></script>
	<script src="/script/utils.js"></script>
	<script>
	$(function() {
		
		// submitButton 버튼 클릭시 데이터를 url로 전송하고 토큰값을 json형태로 받아오는 ajax
		$('#queryButton').on("click", function(event) {
			event.preventDefault();
			$.ajax({
				type : 'post',
				url : '/api/v1/db/query', 
				headers : {
					"Content-Type" : "application/json",
					"X-HTTP-Method-Override" : "POST",
		          	Authorization : $("#authorization").val()
				},
				dataType : 'text',
			    data: JSON.stringify({			// data를 JSON.stringify 해서 post. controller에서 @RequestBody DBConnectionInfo dbConnectionInfo로 받음. 
			    	query: $("#query").val(),
			    }),
				success : function (result) {
					var formattedJson = goodFormatReplaceJson(result);		// utils.js의 goodFormatReplaceJson함수를 호출헤서 json을 보기 좋은 포맷으로 변환
					$(".result").html(formattedJson);
					$(".result").show();
				}
				
			});
		});

		var token = readCookie("token");
		
		$("#authorization").val(token);
	   /*  var token = '${token}';

	    alert(token); */
		//$(".result").html(token);
	    $(".q1").click(function() { $("#query").val(queryFirst);  });
	    $(".q2").click(function() { $("#query").val(querySecond);  });
	    $(".q3").click(function() { $("#query").val(queryThird);  });
	    
	    var queryFirst = "match (a)<-[c:produced]-(b)  return id(a),label(a),a.title, id(b),label(b),b.name, label(c), id(c)  limit 10";	    
	    var querySecond = "match+path%3D(a%3Aproduction)-%5B%5D-(b%3Acompany)+where+id(a)+%3D+'4.7058'+return+nodes(path)+as+NODES%2C+edges(path)+as+EDGES%2C+id(+(nodes(path))%5B1%5D+)+as+HEAD%2C+id(+(nodes(path))%5Blength(path)%2B1%5D+)+as+TAIL";
	    var queryThird = "select * from member";
	});
	
	function readCookie(name) {
	    var nameEQ = encodeURIComponent(name) + "=";
	    var ca = document.cookie.split(';');
	    for (var i = 0; i < ca.length; i++) {
	        var c = ca[i];
	        while (c.charAt(0) === ' ') c = c.substring(1, c.length);
	        if (c.indexOf(nameEQ) === 0) return decodeURIComponent(c.substring(nameEQ.length, c.length));
	    }
	    return null;
	}
	</script>
</head>
<body>
	<div class="navi">
		<ul>
			<li class="q1">query1</li>
			<li class="q2">query2</li>
			<li class="q3">query3</li>
		</ul>
	</div>
	<div class="contents">
		<form name = "queryForm" id="queryForm" action="/api/v1/db/query">
			<p><label for="username">Authorization: </label><input type="text" id="authorization" class="authorization" name="authorization" /></p>
			<p><label for="query">QUERY: </label><input type="text" id="query" class="query" name="query" value="match (a)<-[c:produced]-(b)  return id(a),label(a),a.title, id(b),label(b),b.name, label(c), id(c)  limit 10"/></p>
			<p><button id="queryButton">query</button></p>
		</form>	
	</div>
	<div class="result"></div>
</body>
</html>




















